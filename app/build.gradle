import groovy.json.JsonSlurper

apply plugin: "com.android.application"
apply plugin: "kotlin-android"
apply plugin: "kotlin-android-extensions"
apply plugin: "com.getkeepsafe.dexcount"

buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath "com.neenbedankt.gradle.plugins:android-apt:1.8"
    }
}

android {
    compileSdkVersion rootProject.compileSdkV
    buildToolsVersion rootProject.buildToolsV

    defaultConfig {
        versionCode 1
        versionName "1.0"
        applicationId "suhockii.rxmusic"
        vectorDrawables.useSupportLibrary true
        minSdkVersion rootProject.minSdkV
        targetSdkVersion rootProject.targetSdkV
    }
    buildTypes {
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
        }
        debug {
            minifyEnabled false
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_7
        targetCompatibility JavaVersion.VERSION_1_7
    }
    lintOptions {
        abortOnError true
        ignore "UnusedResources"
    }
    packagingOptions {
        exclude "META-INF/rxjava.properties"
    }
    productFlavors {
        dev {
            def filePath = "app-credentials.json"
            def agent = (new JsonSlurper().parseText(file(filePath).text)).user_agent
            def vkSecret = (new JsonSlurper().parseText(file(filePath).text)).vk_client_secret
            def vkClientId = (new JsonSlurper().parseText(file(filePath).text)).vk_client_id
            def googleKey = (new JsonSlurper().parseText(file(filePath).text)).google_key
            def googleCx = (new JsonSlurper().parseText(file(filePath).text)).google_cx
            buildConfigField("String", "USER_AGENT", "\"" + agent + "\"")
            buildConfigField("String", "VK_CLIENT_SECRET", "\"" + vkSecret + "\"")
            buildConfigField("String", "VK_CLIENT_ID", "\"" + vkClientId + "\"")
            buildConfigField("String", "GOOGLE_KEY", "\"" + googleKey + "\"")
            buildConfigField("String", "GOOGLE_CX", "\"" + googleCx + "\"")
        }
    }
}

kapt {
    generateStubs = true
}

dependencies {
    compile(
            rootProject.kotlin,
            rootProject.rxJava,
            rootProject.rxAndroid,
            rootProject.rxPermissions,
            rootProject.rxJavaAdapter,
            rootProject.retrofit,
            rootProject.gsonConverter,
            rootProject.dagger,
            rootProject.moxy,
            rootProject.moxyAppcompat,
            rootProject.conductor,
            rootProject.glide,
            rootProject.design,
            rootProject.constraint,
            rootProject.slidinguppanel,
            rootProject.bottomSheet
    )
    debugCompile(
            rootProject.stethoOkhttp,
            rootProject.leakcanary
    )
    kapt(
            rootProject.moxyCompiler,
            rootProject.daggerCompiler
    )
    repositories {
        mavenCentral()
    }
    compile "com.google.firebase:firebase-database:10.0.1"
}

apply plugin: "com.google.gms.google-services"